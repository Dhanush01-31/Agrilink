{% extends 'base.html' %}
{% block content %}

<style>
:root {
    --primary-green: #10B981;
    --light-green: #D1FAE5;
    --dark-green: #059669;
    --accent-gold: #F59E0B;
    --accent-blue: #3B82F6;
    --gray-50: #F9FAFB;
    --gray-100: #F3F4F6;
    --gray-200: #E5E7EB;
    --gray-300: #D1D5DB;
    --gray-700: #374151;
    --gray-900: #111827;
}

.dashboard-container {
    background: linear-gradient(135deg, #f0fdf4 0%, #f8fafc 100%);
    min-height: 100vh;
}

/* Header Styles */
.dashboard-header {
    background: white;
    border-radius: 20px;
    padding: 2rem;
    margin: 1.5rem 0;
    box-shadow: 0 4px 20px rgba(16, 185, 129, 0.08);
    border: 1px solid var(--light-green);
    position: relative;
    overflow: hidden;
}

.dashboard-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--primary-green), var(--accent-gold));
}

.header-title {
    color: var(--gray-900);
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.header-subtitle {
    color: var(--gray-700);
    font-size: 1rem;
}

/* Stats Cards */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 1.5rem;
    margin: 2rem 0;
}

.stat-card {
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
    border: 1px solid var(--gray-100);
    cursor: pointer;
}

.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(16, 185, 129, 0.12);
}

.stat-icon {
    width: 56px;
    height: 56px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
}

.stat-icon.lands {
    background: linear-gradient(135deg, #D1FAE5, #A7F3D0);
    color: var(--dark-green);
}

.stat-icon.requests {
    background: linear-gradient(135deg, #FEF3C7, #FDE68A);
    color: #D97706;
}

.stat-icon.approved {
    background: linear-gradient(135deg, #DBEAFE, #BFDBFE);
    color: #1D4ED8;
}

.stat-number {
    font-size: 2rem;
    font-weight: 700;
    color: var(--gray-900);
    line-height: 1;
}

.stat-label {
    color: var(--gray-700);
    font-size: 0.875rem;
    margin-top: 0.25rem;
}

/* Section Headers */
.section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin: 3rem 0 1.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid var(--gray-100);
}

.section-title-container {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.section-icon {
    width: 40px;
    height: 40px;
    background: var(--light-green);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--dark-green);
}

.section-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--gray-900);
    margin: 0;
}

.view-all-btn {
    background: transparent;
    border: 1px solid var(--gray-300);
    color: var(--gray-700);
    border-radius: 8px;
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
    transition: all 0.2s ease;
}

.view-all-btn:hover {
    background: var(--gray-50);
    border-color: var(--primary-green);
    color: var(--primary-green);
}

/* Request Cards */
.requests-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 1.5rem;
    margin-bottom: 3rem;
}

.request-card {
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    border: 1px solid var(--gray-100);
    transition: all 0.3s ease;
    cursor: pointer;
}

.request-card:hover {
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    border-color: var(--primary-green);
}

.request-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 1rem;
}

.farm-name {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--gray-900);
    margin: 0;
}

.request-badge {
    padding: 0.375rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.badge-pending {
    background: #FEF3C7;
    color: #D97706;
}

.badge-approved {
    background: #D1FAE5;
    color: var(--dark-green);
}

.badge-rejected {
    background: #FEE2E2;
    color: #DC2626;
}

.request-message {
    color: var(--gray-700);
    font-size: 0.95rem;
    line-height: 1.5;
    margin-bottom: 1rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.farmer-info {
    background: var(--gray-50);
    border-radius: 12px;
    padding: 1rem;
    margin: 1rem 0;
    border-left: 4px solid var(--primary-green);
}

.farmer-name {
    font-weight: 600;
    color: var(--gray-900);
    margin-bottom: 0.25rem;
    font-size: 1rem;
}

.farmer-experience {
    color: var(--gray-700);
    font-size: 0.875rem;
    margin-bottom: 0.25rem;
}

.farmer-years {
    color: var(--dark-green);
    font-size: 0.875rem;
    font-weight: 500;
}

.request-actions {
    display: flex;
    gap: 0.75rem;
    margin-top: 1rem;
}

/* Land Cards */
.lands-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}

.land-card {
    background: white;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid var(--gray-100);
    cursor: pointer;
    position: relative;
}

.land-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 40px rgba(16, 185, 129, 0.15);
    border-color: var(--primary-green);
}

.land-image {
    height: 200px;
    width: 100%;
    object-fit: cover;
    border-bottom: 1px solid var(--gray-100);
}

.land-placeholder {
    height: 200px;
    background: linear-gradient(135deg, var(--light-green), #A7F3D0);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--dark-green);
    font-size: 4rem;
}

.land-content {
    padding: 1.5rem;
}

.land-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--gray-900);
    margin-bottom: 0.75rem;
}

.land-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.land-tag {
    padding: 0.375rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 500;
    background: var(--gray-100);
    color: var(--gray-700);
}

.land-tag.soil {
    background: #E0F2FE;
    color: #0369A1;
}

.land-tag.crop {
    background: #FCE7F3;
    color: #BE185D;
}

.land-location {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--gray-700);
    font-size: 0.875rem;
    margin-top: 1rem;
}

.delete-btn {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: rgba(239, 68, 68, 0.9);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 0.5rem 1rem;
    font-size: 0.75rem;
    font-weight: 500;
    backdrop-filter: blur(4px);
    transition: all 0.2s ease;
    z-index: 10;
}

.delete-btn:hover {
    background: #DC2626;
    transform: scale(1.05);
}

/* Add Land Button */
.add-land-btn {
    background: linear-gradient(135deg, var(--primary-green), var(--dark-green));
    color: white;
    border: none;
    border-radius: 12px;
    padding: 0.875rem 1.75rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.add-land-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
}

/* Empty States */
.empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: white;
    border-radius: 20px;
    border: 2px dashed var(--gray-200);
}

.empty-icon {
    font-size: 4rem;
    color: var(--gray-300);
    margin-bottom: 1rem;
}

.empty-text {
    color: var(--gray-700);
    font-size: 1.125rem;
    margin-bottom: 0.5rem;
}

.empty-subtext {
    color: var(--gray-500);
    font-size: 0.875rem;
}

/* Modal Improvements */
.modal-content {
    border-radius: 20px;
    border: none;
    overflow: hidden;
}

.modal-header {
    background: linear-gradient(135deg, var(--primary-green), var(--dark-green));
    color: white;
    border: none;
    padding: 1.5rem 2rem;
}

.modal-title {
    font-weight: 600;
    font-size: 1.5rem;
}

.btn-close-white {
    filter: invert(1) grayscale(100%) brightness(200%);
}

.form-input {
    border: 2px solid var(--gray-200);
    border-radius: 10px;
    padding: 0.875rem 1rem;
    transition: all 0.3s ease;
}

.form-input:focus {
    border-color: var(--primary-green);
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
}

/* Farmer Request Modal Specific */
.farmer-details-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    margin: 1.5rem 0;
}

.farmer-detail-card {
    background: var(--gray-50);
    border-radius: 12px;
    padding: 1rem;
    border-left: 4px solid var(--accent-blue);
}

.detail-label {
    font-size: 0.75rem;
    color: var(--gray-600);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.25rem;
}

.detail-value {
    font-size: 1rem;
    font-weight: 600;
    color: var(--gray-900);
}

.request-meta {
    display: flex;
    gap: 1.5rem;
    margin: 1rem 0;
    padding: 1rem;
    background: linear-gradient(135deg, #F0F9FF, #E0F2FE);
    border-radius: 12px;
}

.meta-item {
    display: flex;
    flex-direction: column;
}

.meta-label {
    font-size: 0.75rem;
    color: var(--gray-600);
}

.meta-value {
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--gray-900);
}

/* Action Buttons */
.action-buttons {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--gray-200);
}

.btn-approve {
    background: linear-gradient(135deg, var(--primary-green), var(--dark-green));
    color: white;
    border: none;
    border-radius: 10px;
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    flex: 1;
    transition: all 0.3s ease;
}

.btn-approve:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.btn-reject {
    background: white;
    color: #DC2626;
    border: 2px solid #FECACA;
    border-radius: 10px;
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    flex: 1;
    transition: all 0.3s ease;
}

.btn-reject:hover {
    background: #FEF2F2;
    border-color: #DC2626;
    transform: translateY(-2px);
}

/* Responsive */
@media (max-width: 768px) {
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .requests-grid,
    .lands-grid {
        grid-template-columns: 1fr;
    }
    
    .dashboard-header {
        padding: 1.5rem;
    }
    
    .header-title {
        font-size: 1.5rem;
    }
    
    .farmer-details-grid {
        grid-template-columns: 1fr;
    }
    
    .request-meta {
        flex-direction: column;
        gap: 0.75rem;
    }
    
    .action-buttons {
        flex-direction: column;
    }
}
</style>

<div class="dashboard-container">
    <div class="container py-4">

        <!-- Header -->
        <div class="dashboard-header">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <h1 class="header-title">ðŸŒ¾ FarmLand Manager</h1>
                    <p class="header-subtitle">Manage your agricultural lands and farmer collaborations</p>
                </div>
                <button class="add-land-btn" data-bs-toggle="modal" data-bs-target="#addLandModal">
                    <i class="bi bi-plus-lg"></i> Add New Land
                </button>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card" onclick="window.location.hash='#lands'">
                <div class="stat-icon lands">
                    <i class="bi bi-tree-fill"></i>
                </div>
                <div>
                    <div class="stat-number">{{ lands|length }}</div>
                    <div class="stat-label">Total Lands</div>
                </div>
            </div>
            
            <div class="stat-card" onclick="window.location.hash='#requests'">
                <div class="stat-icon requests">
                    <i class="bi bi-envelope-paper-fill"></i>
                </div>
                <div>
                    <div class="stat-number">{{ requests|length }}</div>
                    <div class="stat-label">Farmer Requests</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon approved">
                    <i class="bi bi-check-circle-fill"></i>
                </div>
                <div>
                    <div class="stat-number">{{ approved_count }}</div>
                    <div class="stat-label">Approved Requests</div>
                </div>
            </div>
        </div>

        <!-- Farmer Requests Section -->
        <div class="section-header" id="requests">
            <div class="section-title-container">
                <div class="section-icon">
                    <i class="bi bi-envelope-fill"></i>
                </div>
                <h2 class="section-title">Farmer Requests</h2>
            </div>
            {% if requests %}
            <button class="view-all-btn" onclick="showAllRequests()">
                View All <i class="bi bi-arrow-right ms-1"></i>
            </button>
            {% endif %}
        </div>

        {% if requests %}
        <div class="requests-grid">
            {% for r in requests|slice:":4" %}
            <div class="request-card"
                 data-bs-toggle="modal"
                 data-bs-target="#requestModal"
                 data-request-id="{{ r.id }}"
                 data-farm-name="{{ r.land.farm_name }}"
                 data-farmer-name="{% if r.farmer.farmer_details %}{{ r.farmer.farmer_details.farmer_name }}{% else %}{{ r.farmer.username }}{% endif %}"
                 data-farmer-experience="{% if r.farmer.farmer_details %}{{ r.farmer.farmer_details.field_experience }}{% else %}No experience specified{% endif %}"
                 data-farmer-years="{% if r.farmer.farmer_details %}{{ r.farmer.farmer_details.experience_years }} years{% else %}N/A{% endif %}"
                 data-farmer-phone="{% if r.farmer.farmer_details %}{{ r.farmer.farmer_details.phone }}{% else %}Not provided{% endif %}"
                 data-farmer-email="{{ r.farmer.email }}"
                 data-request-date="{{ r.created_at|date:'M d, Y' }}"
                 data-request-status="{{ r.status }}"
                 data-request-message="{{ r.message }}"
                 data-land-location="{{ r.land.location }}"
                 data-land-soil="{{ r.land.get_soil_type_display }}"
                 data-land-suitable="{{ r.land.get_suitable_for_display }}">
                
                <div class="request-header">
                    <h5 class="farm-name">{{ r.land.farm_name }}</h5>
                    <span class="request-badge badge-{{ r.status }}">
                        {{ r.status|title }}
                    </span>
                </div>
                
                <p class="request-message">{{ r.message|truncatechars:120 }}</p>
                
                {% if r.farmer.farmer_details %}
                <div class="farmer-info">
                    <div class="farmer-name">{{ r.farmer.farmer_details.farmer_name }}</div>
                    <div class="farmer-experience">{{ r.farmer.farmer_details.field_experience }}</div>
                    <div class="farmer-years">
                        <i class="bi bi-clock-history"></i> {{ r.farmer.farmer_details.experience_years }} years experience
                    </div>
                </div>
                {% else %}
                <div class="farmer-info">
                    <div class="farmer-name">{{ r.farmer.username }}</div>
                    <div class="farmer-experience">Farmer details not provided</div>
                </div>
                {% endif %}
                
                <div class="text-end">
                    <small class="text-muted">
                        <i class="bi bi-calendar"></i> {{ r.created_at|date:"M d, Y" }}
                    </small>
                </div>
            </div>
            {% endfor %}
        </div>
        
        {% if requests|length > 4 %}
        <div class="text-center mt-3">
            <button class="btn btn-outline-success" onclick="showAllRequests()">
                View {{ requests|length|add:"-4" }} more requests
            </button>
        </div>
        {% endif %}
        
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">ðŸ“­</div>
            <h3 class="empty-text">No requests yet</h3>
            <p class="empty-subtext">Farmer requests will appear here when farmers show interest in your lands</p>
        </div>
        {% endif %}

        <!-- My Lands Section -->
        <div class="section-header" id="lands">
            <div class="section-title-container">
                <div class="section-icon">
                    <i class="bi bi-geo-alt-fill"></i>
                </div>
                <h2 class="section-title">My Agricultural Lands</h2>
            </div>
            <button class="view-all-btn" onclick="scrollToLands()">
                View All <i class="bi bi-arrow-right ms-1"></i>
            </button>
        </div>

        {% if lands %}
        <div class="lands-grid">
            {% for land in lands %}
            <div class="land-card"
                 data-bs-toggle="modal"
                 data-bs-target="#landModal"
                 data-name="{{ land.farm_name }}"
                 data-location="{{ land.location }}"
                 data-soil="{{ land.get_soil_type_display }}"
                 data-suitable="{{ land.get_suitable_for_display }}"
                 data-phone="{{ land.phone }}"
                 data-description="{{ land.description }}"
                 data-image="{% if land.images.first %}{{ land.images.first.image.url }}{% endif %}">

                <a href="{% url 'delete_land' land.id %}"
                   class="delete-btn"
                   onclick="event.stopPropagation(); return confirm('Are you sure you want to delete this land?');">
                    <i class="bi bi-trash"></i> Delete
                </a>

                {% if land.images.first %}
                <img src="{{ land.images.first.image.url }}" class="land-image" alt="{{ land.farm_name }}">
                {% else %}
                <div class="land-placeholder">
                    <i class="bi bi-tree"></i>
                </div>
                {% endif %}

                <div class="land-content">
                    <h3 class="land-title">{{ land.farm_name }}</h3>
                    
                    <div class="land-tags">
                        <span class="land-tag soil">{{ land.get_soil_type_display }} Soil</span>
                        <span class="land-tag crop">{{ land.get_suitable_for_display }}</span>
                    </div>
                    
                    <p class="text-muted mb-3 small">{{ land.description|truncatechars:80 }}</p>
                    
                    <div class="land-location">
                        <i class="bi bi-geo-alt"></i>
                        {{ land.location }}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">ðŸŒ±</div>
            <h3 class="empty-text">No lands added yet</h3>
            <p class="empty-subtext">Add your first land to start receiving farmer requests</p>
            <button class="add-land-btn mt-3" data-bs-toggle="modal" data-bs-target="#addLandModal">
                <i class="bi bi-plus-lg"></i> Add Your First Land
            </button>
        </div>
        {% endif %}

    </div>
</div>

<!-- ================= LAND DETAILS MODAL ================= -->
<div class="modal fade" id="landModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="mName"></h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row g-4">
                    <div class="col-md-6">
                        <img id="mImg" class="img-fluid rounded-3 w-100" style="height: 300px; object-fit: cover;" 
                             onerror="this.src='data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 400 300\"><rect width=\"400\" height=\"300\" fill=\"%23d1fae5\"/><text x=\"200\" y=\"150\" font-family=\"Arial\" font-size=\"20\" fill=\"%23059669\" text-anchor=\"middle\">ðŸŒ¾ Farm Image</text></svg>'">
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex flex-column gap-3">
                            <div class="d-flex align-items-center gap-2">
                                <i class="bi bi-geo-alt-fill text-success"></i>
                                <span class="fw-medium">Location:</span>
                                <span id="mLocation" class="ms-2"></span>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <i class="bi bi-droplet-fill text-primary"></i>
                                <span class="fw-medium">Soil Type:</span>
                                <span id="mSoil" class="ms-2"></span>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <i class="bi bi-sun-fill text-warning"></i>
                                <span class="fw-medium">Suitable For:</span>
                                <span id="mSuitable" class="ms-2"></span>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <i class="bi bi-telephone-fill text-info"></i>
                                <span class="fw-medium">Contact:</span>
                                <span id="mPhone" class="ms-2"></span>
                            </div>
                        </div>
                        <hr>
                        <div>
                            <h6 class="fw-medium mb-2">Description</h6>
                            <p id="mDesc" class="text-muted"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ================= FARMER REQUEST DETAILS MODAL ================= -->
<div class="modal fade" id="requestModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Farmer Request Details</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- Request Status Badge -->
                <div class="mb-4">
                    <span id="requestStatusBadge" class="request-badge"></span>
                </div>
                
                <!-- Farm Information -->
                <div class="card border-0 bg-light mb-4">
                    <div class="card-body">
                        <h6 class="fw-bold mb-3">
                            <i class="bi bi-tree-fill text-success me-2"></i>
                            <span id="requestFarmName"></span>
                        </h6>
                        <div class="row">
                            <div class="col-md-6">
                                <small class="text-muted">Location</small>
                                <p id="requestLandLocation" class="mb-2"></p>
                            </div>
                            <div class="col-md-3">
                                <small class="text-muted">Soil Type</small>
                                <p id="requestLandSoil" class="mb-2"></p>
                            </div>
                            <div class="col-md-3">
                                <small class="text-muted">Suitable For</small>
                                <p id="requestLandSuitable" class="mb-2"></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Farmer Details -->
                <h6 class="fw-bold mb-3">
                    <i class="bi bi-person-badge-fill text-primary me-2"></i>
                    Farmer Information
                </h6>
                
                <div class="farmer-details-grid mb-4">
                    <div class="farmer-detail-card">
                        <div class="detail-label">Farmer Name</div>
                        <div class="detail-value" id="requestFarmerName"></div>
                    </div>
                    <div class="farmer-detail-card">
                        <div class="detail-label">Experience Years</div>
                        <div class="detail-value" id="requestFarmerYears"></div>
                    </div>
                    <div class="farmer-detail-card">
                        <div class="detail-label">Field of Expertise</div>
                        <div class="detail-value" id="requestFarmerExperience"></div>
                    </div>
                    <div class="farmer-detail-card">
                        <div class="detail-label">Contact Email</div>
                        <div class="detail-value" id="requestFarmerEmail"></div>
                    </div>
                </div>
                
                <!-- Request Message -->
                <h6 class="fw-bold mb-3">
                    <i class="bi bi-chat-left-text-fill text-warning me-2"></i>
                    Request Message
                </h6>
                <div class="card border-0 bg-gray-50 mb-4">
                    <div class="card-body">
                        <p id="requestMessage" class="mb-0"></p>
                    </div>
                </div>
                
                <!-- Request Meta Information -->
                <div class="request-meta">
                    <div class="meta-item">
                        <div class="meta-label">Request Date</div>
                        <div class="meta-value" id="requestDate"></div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Request ID</div>
                        <div class="meta-value" id="requestId"></div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Contact Phone</div>
                        <div class="meta-value" id="requestFarmerPhone"></div>
                    </div>
                </div>
                
                <!-- Action Form (Only for pending requests) -->
                <form method="POST" action="" id="requestActionForm">
                    {% csrf_token %}
                    <input type="hidden" name="request_id" id="formRequestId">
                    
                    <div id="pendingActions" style="display: none;">
                        <div class="action-buttons">
                            <button type="submit" name="approve_request" class="btn-approve">
                                <i class="bi bi-check-circle me-2"></i> Approve Request
                            </button>
                            <button type="submit" name="reject_request" class="btn-reject">
                                <i class="bi bi-x-circle me-2"></i> Reject Request
                            </button>
                        </div>
                    </div>
                    
                    <div id="approvedMessage" style="display: none;">
                        <div class="alert alert-success d-flex align-items-center" role="alert">
                            <i class="bi bi-check-circle-fill me-3 fs-4"></i>
                            <div>
                                <h6 class="alert-heading mb-1">Request Approved</h6>
                                <p class="mb-0">You have approved this farmer's request. They can now contact you to proceed.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div id="rejectedMessage" style="display: none;">
                        <div class="alert alert-danger d-flex align-items-center" role="alert">
                            <i class="bi bi-x-circle-fill me-3 fs-4"></i>
                            <div>
                                <h6 class="alert-heading mb-1">Request Rejected</h6>
                                <p class="mb-0">You have rejected this farmer's request.</p>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- ================= ADD LAND MODAL ================= -->
<div class="modal fade" id="addLandModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title">Add New Agricultural Land</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label fw-medium">Farm Name *</label>
                            <input name="farm_name" class="form-control form-input" placeholder="e.g., Green Valley Farm" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-medium">Soil Type *</label>
                            <select name="soil_type" class="form-control form-input" required>
                                <option value="">Select soil type</option>
                                <option value="black">Black Soil</option>
                                <option value="red">Red Soil</option>
                                <option value="alluvial">Alluvial Soil</option>
                                <option value="sandy">Sandy Soil</option>
                                <option value="clay">Clay Soil</option>
                                <option value="loamy">Loamy Soil</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-medium">Suitable For *</label>
                            <select name="suitable_for" class="form-control form-input" required>
                                <option value="">Select suitable crops</option>
                                <option value="vegetables">Vegetables</option>
                                <option value="fruits">Fruits</option>
                                <option value="grains">Grains</option>
                                <option value="both">Both Vegetables & Fruits</option>
                                <option value="all">All Crops</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-medium">Location *</label>
                            <input name="location" class="form-control form-input" placeholder="City, State, Country" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-medium">Contact Phone</label>
                            <input name="phone" class="form-control form-input" placeholder="+1 234 567 8900">
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-medium">Description</label>
                            <textarea name="description" class="form-control form-input" rows="3" placeholder="Describe your land, water availability, infrastructure, special features..."></textarea>
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-medium">Land Photos *</label>
                            <div class="border rounded-3 p-3 bg-gray-50">
                                <input type="file" name="images" multiple class="form-control" accept="image/*" required>
                                <div class="form-text mt-2">
                                    <i class="bi bi-info-circle"></i> Upload clear photos (max 5) showing different angles of your land
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button name="add_land" class="btn btn-success px-4">
                        <i class="bi bi-save me-2"></i> Save Land
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Land Modal
    const landModal = document.getElementById('landModal');
    landModal.addEventListener('show.bs.modal', function(event) {
        const button = event.relatedTarget;
        
        // Update modal content
        document.getElementById('mName').textContent = button.dataset.name;
        document.getElementById('mLocation').textContent = button.dataset.location;
        document.getElementById('mSoil').textContent = button.dataset.soil;
        document.getElementById('mSuitable').textContent = button.dataset.suitable;
        document.getElementById('mPhone').textContent = button.dataset.phone;
        document.getElementById('mDesc').textContent = button.dataset.description || 'No description provided';
        
        const image = document.getElementById('mImg');
        if (button.dataset.image) {
            image.src = button.dataset.image;
        }
    });
    
    // Request Modal
    const requestModal = document.getElementById('requestModal');
    requestModal.addEventListener('show.bs.modal', function(event) {
        const button = event.relatedTarget;
        const status = button.dataset.requestStatus;
        
        // Update modal content
        document.getElementById('requestFarmName').textContent = button.dataset.farmName;
        document.getElementById('requestLandLocation').textContent = button.dataset.landLocation;
        document.getElementById('requestLandSoil').textContent = button.dataset.landSoil;
        document.getElementById('requestLandSuitable').textContent = button.dataset.landSuitable;
        document.getElementById('requestFarmerName').textContent = button.dataset.farmerName;
        document.getElementById('requestFarmerExperience').textContent = button.dataset.farmerExperience;
        document.getElementById('requestFarmerYears').textContent = button.dataset.farmerYears;
        document.getElementById('requestFarmerEmail').textContent = button.dataset.farmerEmail;
        document.getElementById('requestFarmerPhone').textContent = button.dataset.farmerPhone;
        document.getElementById('requestMessage').textContent = button.dataset.requestMessage;
        document.getElementById('requestDate').textContent = button.dataset.requestDate;
        document.getElementById('requestId').textContent = button.dataset.requestId;
        document.getElementById('formRequestId').value = button.dataset.requestId;
        
        // Update status badge
        const statusBadge = document.getElementById('requestStatusBadge');
        statusBadge.textContent = status.charAt(0).toUpperCase() + status.slice(1);
        statusBadge.className = `request-badge badge-${status}`;
        
        // Show/hide action buttons based on status
        const pendingActions = document.getElementById('pendingActions');
        const approvedMessage = document.getElementById('approvedMessage');
        const rejectedMessage = document.getElementById('rejectedMessage');
        
        pendingActions.style.display = 'none';
        approvedMessage.style.display = 'none';
        rejectedMessage.style.display = 'none';
        
        if (status === 'pending') {
            pendingActions.style.display = 'block';
        } else if (status === 'approved') {
            approvedMessage.style.display = 'block';
        } else if (status === 'rejected') {
            rejectedMessage.style.display = 'block';
        }
    });
    
    // Add hover effects to cards
    const landCards = document.querySelectorAll('.land-card');
    landCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-8px)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
    
    // Add hover effects to request cards
    const requestCards = document.querySelectorAll('.request-card');
    requestCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-4px)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
});

// Helper functions
function showAllRequests() {
    // This could be expanded to show all requests in a separate page
    alert('Showing all requests. In a full implementation, this would navigate to a requests page.');
}

function scrollToLands() {
    document.getElementById('lands').scrollIntoView({ behavior: 'smooth' });
}

// Prevent modal form from submitting and closing modal (for demo purposes)
document.addEventListener('submit', function(e) {
    if (e.target.closest('#requestActionForm')) {
        e.preventDefault();
        // Show loading state
        const approveBtn = e.target.querySelector('[name="approve_request"]');
        const rejectBtn = e.target.querySelector('[name="reject_request"]');
        
        if (e.submitter === approveBtn) {
            approveBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i> Approving...';
            approveBtn.disabled = true;
            rejectBtn.disabled = true;
            
            // Simulate API call
            setTimeout(() => {
                alert('Request approved successfully!');
                location.reload(); // Reload page to reflect changes
            }, 1000);
        } else if (e.submitter === rejectBtn) {
            rejectBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i> Rejecting...';
            approveBtn.disabled = true;
            rejectBtn.disabled = true;
            
            // Simulate API call
            setTimeout(() => {
                alert('Request rejected successfully!');
                location.reload(); // Reload page to reflect changes
            }, 1000);
        }
    }
});
</script>

{% endblock %}